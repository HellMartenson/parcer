!function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=511)}({1:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.domDispatchEvent=function(e,t,o){var r=document.createEvent("CustomEvent");r.initCustomEvent(e,!0,!0,o),void 0===t?window.dispatchEvent(r):t.dispatchEvent(r)}},105:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UPDATE="compareStorage:UPDATE",e.CLEAR="compareStorage:CLEAR"}(t.CompareStorageEventsEnum||(t.CompareStorageEventsEnum={}))},11:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(3),n=function(){function e(){var e=this;this._waitingElements=[],this.addWaitingState=function(t){r.Dom_addClasses(t,["ajs-placeholder","ajs-placeholder_waiting"]),e._waitingElements.push(t)}}return Object.defineProperty(e.prototype,"service",{set:function(e){this._service=e},enumerable:!0,configurable:!0}),e.prototype.needGetStateAfterBuild=function(e){return!0},e.prototype.afterRefresh=function(e){this._waitingElements.forEach(function(e){setTimeout(function(){e.classList.remove("ajs-placeholder_waiting")}),setTimeout(function(){e.classList.remove("ajs-placeholder")},1e3)}),this._waitingElements=[]},e}();t.AjaxStateProcessorAbstract=n},13:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.WHITE="_white",e.BRAND="_brand",e.BLUE="_blue",e.GREY="_grey"}(t.ButtonColorModifiers||(t.ButtonColorModifiers={}))},17:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.TOP="top",e.BOTTOM="bottom",e.LEFT="left",e.RIGHT="right",e.AUTO="auto",e.AUTO_X="auto-x",e.AUTO_Y="auto-y"}(t.PopoverPlacementsEnum||(t.PopoverPlacementsEnum={}))},224:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.ADD="compare-button:add"}(t.CompareButtonEventsEnum||(t.CompareButtonEventsEnum={}))},26:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringCountPostfix=function(e,t,o,r){if(void 0===o&&(o=!1),0===e&&void 0!==r)return r;var n=0,i=e%10,s=e%100;2<=i&&i<=4&&(n=1),(0===i||i>=5&&i<=9||s>=11&&s<=19)&&(n=2);var a=t[Math.min(n,t.length)]||"";return o?a:e+" "+a}},3:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Dom_addClasses=function(e,t){t.forEach(function(t){e.classList.add(t)})}},511:function(e,t,o){e.exports=o(512)},512:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(513);window.AjaxStateProcessorRegistrator.register("compare-button",new r.CompareButtonProcessor)},513:function(e,t,o){"use strict";var r,n=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])},function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(105),a=o(26),c=o(1),p=i(o(8)),u=o(13),d=o(17),_=o(11),E=o(224),l=function(e){function t(){var t=e.call(this)||this;return t._products=new Map,t._checkboxes=new Map,t._popovers=new Map,t._productsList=new Map,t._screen=new p.default,t._storage=window.compareStorage,window.addEventListener(s.CompareStorageEventsEnum.CLEAR,function(){t.destroyPopovers(),t._checkboxes.forEach(function(e){e.toggle(!1,!1)})}),t}return n(t,e),t.prototype.build=function(e){var t=e.data;return this.render(e),this._products.set(e.id,t.product),this.updateStateData},t.prototype.needGetStateAfterBuild=function(e){var t=e.data;return this.loadProducts(t.product)},t.prototype.refresh=function(e,t){},t.prototype.afterRefresh=function(t){var o=this;e.prototype.afterRefresh.call(this,t);var r=t.data;this._productsList.clear(),r.products.forEach(function(e){o._productsList.set(e.id,e)}),this.initDesktopPopovers()},Object.defineProperty(t.prototype,"updateStateData",{get:function(){return{products:this._storage.getAll()}},enumerable:!0,configurable:!0}),t.prototype.initDesktopPopovers=function(){var e=this;!1!==this.loadProducts()?this._products.forEach(function(t,o){e._isActive(t)||e._popovers.has(o)&&e._popovers.get(o).isShowed?e.initDesktopPopover(o,o===e._lastUpdateInitiator):e.destroyPopovers(o)}):this.destroyPopovers()},t.prototype._isActive=function(e){return this._storage.has(e)},t.prototype.render=function(e){var t=this,o=e.data,r=document.getElementById(e.id);if(null!==r){var n={label:"Сравнить"},i=document.createElement("span");i.classList.add("compare-checkbox");var a=window.controlCheckbox.draw(i,n);this._checkboxes.set(e.id,a),r.parentElement.insertBefore(i,r),a.input.addEventListener("change",function(){t.hideAllPopovers(),t._toggleState(o.product,e.id),t._isActive(o.product)&&c.domDispatchEvent(E.CompareButtonEventsEnum.ADD,a.input)});var p=function(){a.toggle(t._isActive(o.product),!1)};p(),window.addEventListener(s.CompareStorageEventsEnum.UPDATE,p),r.remove()}},t.prototype.hideAllPopovers=function(){this._popovers.forEach(function(e){e.toggle(!1)})},t.prototype.showMobileMessage=function(){if(this._lastUpdateInitiator&&!this._screen.isDesktop&&!this._storage.isEmpty()){var e=["В сравнении",a.stringCountPostfix(this._storage.count(),["товар","товара","товаров"]),'<a href="/compare/" class="compare-popup__link">Смотреть</a>'].join(" ");window.popup.show(e,"compare-popup")}},t.prototype.initDesktopPopover=function(e,t){var o=this;if(this._popovers.has(e))this._popovers.get(e).content=this.initPopoverContent(e);else{var r=this._checkboxes.get(e).element,n=window.popoverBlock.draw(r,"",{class:"compare-popover"},{placement:d.PopoverPlacementsEnum.AUTO_Y,inBody:!0,trigger:"hover"});n.beforeShowCallback=function(){n.content=o.initPopoverContent(e)},t&&this._lastUpdateInitiator===e&&n.toggle(!0,2e3),this._popovers.set(e,n)}},t.prototype.initPopoverContent=function(e){var t=this;if(0===this._productsList.size)return null;var o=document.createElement("div");o.classList.add("compare-popover__container");var r=function(e){return"Сравнить ("+e+")"},n=window.button.create(r(this._storage.count()),u.ButtonColorModifiers.BRAND,{href:"/compare/"}),i=document.createElement("div");i.classList.add("compare-popover__products-list"),4<this._storage.count()&&i.classList.add("compare-popover__products-list_scrollable"),this._productsList.forEach(function(e,o){var s=document.createElement("div");s.classList.add("compare-popover__product");var a=window.links.createLinkBase("",e.url);a.classList.add("compare-popover__product-link");var c=document.createElement("div");c.classList.add("compare-popover__wrap-image"),a.appendChild(c);var p=document.createElement("img");p.src=e.image,p.classList.add("compare-popover__product-image"),c.appendChild(p);var u=document.createElement("span");u.innerText=e.title,u.classList.add("compare-popover__product-title"),a.appendChild(u),s.appendChild(a);var d=document.createElement("span");d.classList.add("compare-popover__product-remove-link"),d.addEventListener("click",function(a){a.preventDefault(),t._storage.remove(e.id),t._productsList.delete(o),i.removeChild(s),!1===t._storage.isEmpty()&&(n.element.innerText=r(t._storage.count()))}),a.appendChild(d),i.appendChild(s)}),o.appendChild(i);var s=document.createElement("div");s.classList.add("compare-popover__buttons");var a=window.links.createLinkBase("","",!0);a.classList.add("compare-popover__product-clear-btn"),a.addEventListener("click",function(e){e.preventDefault(),t._storage.clear(),t.destroyPopovers(),t._productsList.clear()}),s.appendChild(a);var c=document.createElement("span");return c.innerText="Очистить все",c.classList.add("compare-popover__product-clear-text"),a.appendChild(c),s.appendChild(n.element),o.appendChild(s),o},t.prototype.destroyPopovers=function(e){e?this._popovers.has(e)&&(this._popovers.get(e).destroy(),this._popovers.delete(e)):(this._popovers.forEach(function(e){e.destroy()}),this._popovers.clear())},t.prototype.loadProducts=function(e){return!1!==this._screen.isDesktop&&(e?this._storage.has(e):!1===this._storage.isEmpty())},t.prototype._toggleState=function(e,t){!1===this._isActive(e)?this._storage.add(e):(this._storage.remove(e),this.destroyPopovers(t),this._productsList.delete(e)),this._lastUpdateInitiator===t&&!1!==this._storage.has(e)||(this._lastUpdateInitiator=t,this.destroyPopovers()),this.loadProducts()&&this._service.updateState(t,this.updateStateData),this.showMobileMessage()},t}(_.AjaxStateProcessorAbstract);t.CompareButtonProcessor=l},6:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SCREEN_NOT_SUPPORTED=0]="SCREEN_NOT_SUPPORTED",e[e.SCREEN_WIDE=1]="SCREEN_WIDE",e[e.SCREEN_DESKTOP=2]="SCREEN_DESKTOP",e[e.SCREEN_TABLET=3]="SCREEN_TABLET",e[e.SCREEN_MOBILE=4]="SCREEN_MOBILE"}(t.ScreenTypes||(t.ScreenTypes={}))},8:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(6),n=function(){function e(){var e=this;this.SCREEN_MOBILE_MIN_WIDTH=320,this.SCREEN_MOBILE_MAX_WIDTH=767,this.SCREEN_TABLET_MAX_WIDTH=991,this.SCREEN_DESKTOP_MAX_WIDTH=1199,this.EVENT_RESIZE="resize",this.EVENT_OPTIMIZED_RESIZE="optimizedResize",this.EVENT_SCREEN_TYPE_CHANGED="screenTypeChanged",this._currentScreenType=null,this.optimizeResizeEvent=function(t){var o=!1;(t=t||window).addEventListener(e.EVENT_RESIZE,function(){o||(o=!0,requestAnimationFrame(function(){t.dispatchEvent(new CustomEvent(e.EVENT_OPTIMIZED_RESIZE));var r=e.calcCurrent();e._currentScreenType!==r&&(e._currentScreenType=r,t.dispatchEvent(new CustomEvent(e.EVENT_SCREEN_TYPE_CHANGED))),o=!1}))})}}return Object.defineProperty(e.prototype,"current",{get:function(){return null===this._currentScreenType&&(this._currentScreenType=this.calcCurrent()),this._currentScreenType},enumerable:!0,configurable:!0}),e.prototype.calcCurrent=function(){var e=document.querySelector('meta[name="screen-type-helper"]');if(null!==e)return parseInt(e.content,10);var t=window.matchMedia;if(t){if(t("(min-width: "+(this.SCREEN_DESKTOP_MAX_WIDTH+1)+"px)").matches)return r.ScreenTypes.SCREEN_WIDE;if(t("(min-width: "+(this.SCREEN_TABLET_MAX_WIDTH+1)+"px)").matches)return r.ScreenTypes.SCREEN_DESKTOP;if(t("(min-width: "+(this.SCREEN_MOBILE_MAX_WIDTH+1)+"px)").matches)return r.ScreenTypes.SCREEN_TABLET;if(t("(min-width: "+this.SCREEN_MOBILE_MIN_WIDTH+"px)").matches)return r.ScreenTypes.SCREEN_MOBILE}else{var o=window.innerWidth;if(o>this.SCREEN_DESKTOP_MAX_WIDTH)return r.ScreenTypes.SCREEN_WIDE;if(o>this.SCREEN_TABLET_MAX_WIDTH)return r.ScreenTypes.SCREEN_DESKTOP;if(o>this.SCREEN_MOBILE_MAX_WIDTH)return r.ScreenTypes.SCREEN_TABLET;if(o>=this.SCREEN_MOBILE_MIN_WIDTH)return r.ScreenTypes.SCREEN_MOBILE}return r.ScreenTypes.SCREEN_NOT_SUPPORTED},e.prototype.check=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var o=0,r=e;o<r.length;o++){if(r[o]===this.current)return!0}return!1},Object.defineProperty(e.prototype,"isDesktop",{get:function(){return this.check(r.ScreenTypes.SCREEN_DESKTOP,r.ScreenTypes.SCREEN_WIDE)},enumerable:!0,configurable:!0}),e.prototype.addResizeListener=function(e){this.optimizeResizeEvent(window),window.addEventListener(this.EVENT_OPTIMIZED_RESIZE,e)},e.prototype.removeResizeListener=function(e){window.removeEventListener(this.EVENT_OPTIMIZED_RESIZE,e)},e.prototype.addChangeScreenTypeListener=function(e){this.optimizeResizeEvent(window),window.addEventListener(this.EVENT_SCREEN_TYPE_CHANGED,e)},e.prototype.removeChangeScreenTypeListener=function(e){window.removeEventListener(this.EVENT_SCREEN_TYPE_CHANGED,e)},e}();t.default=n}});